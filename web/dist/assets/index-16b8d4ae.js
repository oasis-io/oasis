/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                   */import"./el-form-item-4ed993c7.js";/* empty css                    */import{d as me,r as d,a as b,o as c,c as g,j as w,b as l,w as t,h as p,F as T,s as L,y as pe,x as N,t as U,g as $,ao as ce,a7 as fe,ap as we,L as V,a4 as G,aq as ge,m as ve,Y as he,Z as ye,$ as _e,k as be,l as Ve,a0 as ke,a1 as xe,E as Pe,a2 as Fe,ar as Ce,as as Ue,at as Ee}from"./index-95ad95c9.js";const Re={class:"table-box"},ze={class:"button-left"},qe={key:0},Be={class:"pagination"},Se={class:"dialog-footer"},De={class:"dialog-footer"},Te={class:"dialog-footer"},Ye=me({__name:"index",setup(Le){const M=d(0),v=d(1),h=d(10),j=d([]),H=d(!1),J=d(!1),Q=d(!1),y=d(),E=d(),R=d(),k=d(!1),x=d(!1),P=d(!1),F=d([]),X=(s,e,o)=>{if(e==="")o(new Error("请输入密码"));else{if(r.checkPass!==""){if(!y.value)return;y.value.validateField("checkPass",()=>null)}o()}},ee=(s,e,o)=>{e===""?o(new Error("请再次输入密码")):e!=r.password?o(new Error("输入的密码不相同!")):o()},ae=b({password:[{required:!0,trigger:"blur"},{required:!0,min:6,max:30,trigger:"blur"}],checkPass:[{required:!0,trigger:"blur"},{required:!0,min:6,max:30,trigger:"blur"},{validator:(s,e,o)=>{e===""?o(new Error("请再次输入密码")):e!==f.password?o(new Error("两次输入密码不一致!")):o()},trigger:"blur"}]}),A=b({username:[{required:!0,trigger:"blur"}],password:[{validator:X},{required:!0,min:6,max:30,trigger:"blur"}],checkPass:[{validator:ee},{required:!0,min:6,max:30,trigger:"blur"}]}),le=s=>{h.value=s,_()},te=s=>{v.value=s,_()},_=async()=>{const s=await ce({pageSize:h.value,currentPage:v.value});s.data.code===1e3&&(j.value=s.data.data.data,M.value=s.data.data.total,h.value=s.data.data.pageSize,v.value=s.data.data.currentPage)};(async()=>{await _()})();const oe=async s=>{fe.confirm("此操作将永久删除该用户, 是否继续?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{(await we({username:s.username})).data.code===1e3?(V({type:"success",message:"用户删除成功"}),await _()):V({type:"error",message:"用户删除失败"})}).catch(()=>{V({type:"info",message:"取消删除用户"})})},se=async s=>{f.username=s.username,P.value=!0},re=async()=>{k.value=!0;const s=await G();s.data.code===1e3&&(F.value=s.data.data.data.map(e=>({label:e,value:e})))},ne=async s=>{x.value=!0;const e=await ge({username:s.username});e.data.code===1e3&&(n.username=e.data.data.data[0].username,n.email=e.data.data.data[0].email,n.phone=e.data.data.data[0].phone,n.password=e.data.data.data[0].password,n.roles=e.data.data.data[0].roles.map(i=>i.name));const o=await G();o.data.code===1e3&&(F.value=o.data.data.data.map(i=>({label:i,value:i})))},r=b({username:"",email:"",phone:"",password:"",checkPass:"",roles:[]}),n=b({username:"",email:"",phone:"",password:"",roles:[]}),f=b({username:"",password:"",checkPass:""}),I=async()=>{y.value.resetFields(),k.value=!1},O=async()=>{E.value.resetFields(),x.value=!1},K=async()=>{R.value.resetFields(),P.value=!1},z=async(s,e,o,i,q,B)=>{s.value.validate(async m=>{m&&((await q(e)).data.code===1e3?(V({type:"success",message:o}),B(),await _()):V({type:"error",message:i}))})},de=async()=>{await z(y,r,"用户创建成功","用户创建失败",Ce,I)},ue=async()=>{await z(E,n,"用户修改成功","用户修改失败",Ue,O)},ie=async()=>{await z(R,f,"用户密码修改成功","用户密码修改失败",Ee,K)};return(s,e)=>{const o=ve,i=he,q=ye,B=_e,m=be,u=Ve,W=ke,Y=xe,S=Pe,D=Fe;return c(),g("div",Re,[w("div",ze,[l(o,{type:"primary",icon:"plus",onClick:re},{default:t(()=>[p("新增用户")]),_:1})]),l(q,{data:j.value,style:{width:"100%"}},{default:t(()=>[l(i,{align:"left",prop:"username","min-width":"150",label:"用户名"}),l(i,{align:"left",prop:"email","min-width":"180",label:"邮箱","show-overflow-tooltip":""}),l(i,{align:"left",prop:"phone","min-width":"150",label:"手机号"}),l(i,{align:"left","min-width":"180",label:"角色"},{default:t(a=>[(c(!0),g(T,null,L(a.row.roles,(C,Z)=>(c(),g("span",{key:Z},[p(pe(C.name),1),Z!==a.row.roles.length-1?(c(),g("span",qe,", ")):N("",!0)]))),128))]),_:1}),l(i,{label:"操作","min-width":"249",fixed:"right"},{default:t(a=>[a.row.username!=="admin"?(c(),U(o,{key:0,icon:"edit",type:"primary",link:"",onClick:$(C=>ne(a.row),["prevent"])},{default:t(()=>[p(" 编辑 ")]),_:2},1032,["onClick"])):N("",!0),a.row.username!=="admin"?(c(),U(o,{key:1,icon:"delete",type:"primary",link:"",onClick:$(C=>oe(a.row),["prevent"])},{default:t(()=>[p(" 删除 ")]),_:2},1032,["onClick"])):N("",!0),l(o,{icon:"Lock",type:"primary",link:"",onClick:$(C=>se(a.row),["prevent"])},{default:t(()=>[p(" 修改密码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w("div",Be,[l(B,{"current-page":v.value,"onUpdate:currentPage":e[0]||(e[0]=a=>v.value=a),"page-size":h.value,"onUpdate:pageSize":e[1]||(e[1]=a=>h.value=a),"page-sizes":[10,20,50,100],small:H.value,disabled:Q.value,background:J.value,layout:"total, sizes, prev, pager, next, jumper",total:M.value,onSizeChange:le,onCurrentChange:te},null,8,["current-page","page-size","small","disabled","background","total"])]),l(D,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),title:"创建用户",width:"40%"},{footer:t(()=>[w("span",Se,[l(o,{onClick:I},{default:t(()=>[p("关闭")]),_:1}),l(o,{type:"primary",onClick:de},{default:t(()=>[p("提交")]),_:1})])]),default:t(()=>[w("div",null,[l(S,{ref_key:"addFormRef",ref:y,model:r,"status-icon":"",rules:A,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(m,{modelValue:r.username,"onUpdate:modelValue":e[2]||(e[2]=a=>r.username=a),maxlength:"18","show-word-limit":"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(u,{label:"邮件",prop:"email"},{default:t(()=>[l(m,{modelValue:r.email,"onUpdate:modelValue":e[3]||(e[3]=a=>r.email=a),maxlength:"30","show-word-limit":"",placeholder:"请输入邮件"},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:t(()=>[l(m,{modelValue:r.phone,"onUpdate:modelValue":e[4]||(e[4]=a=>r.phone=a),maxlength:"18","show-word-limit":"",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"密码",prop:"password"},{default:t(()=>[l(m,{modelValue:r.password,"onUpdate:modelValue":e[5]||(e[5]=a=>r.password=a),placeholder:"请输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码",prop:"checkPass"},{default:t(()=>[l(m,{modelValue:r.checkPass,"onUpdate:modelValue":e[6]||(e[6]=a=>r.checkPass=a),placeholder:"请再次输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"roles"},{default:t(()=>[l(Y,{modelValue:r.roles,"onUpdate:modelValue":e[7]||(e[7]=a=>r.roles=a),multiple:"",clearable:"",style:{width:"100%"},placeholder:"请选择角色"},{default:t(()=>[(c(!0),g(T,null,L(F.value,a=>(c(),U(W,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"]),l(D,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=a=>x.value=a),title:"修改用户",width:"40%"},{footer:t(()=>[w("span",De,[l(o,{onClick:O},{default:t(()=>[p("关闭")]),_:1}),l(o,{type:"primary",onClick:ue},{default:t(()=>[p("提交")]),_:1})])]),default:t(()=>[w("div",null,[l(S,{ref_key:"editFormRef",ref:E,model:n,"status-icon":"",rules:A,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(m,{modelValue:n.username,"onUpdate:modelValue":e[9]||(e[9]=a=>n.username=a),disabled:"",maxlength:"18","show-word-limit":"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(u,{label:"邮件",prop:"email"},{default:t(()=>[l(m,{modelValue:n.email,"onUpdate:modelValue":e[10]||(e[10]=a=>n.email=a),maxlength:"30","show-word-limit":"",placeholder:"请输入邮件"},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:t(()=>[l(m,{modelValue:n.phone,"onUpdate:modelValue":e[11]||(e[11]=a=>n.phone=a),maxlength:"18","show-word-limit":"",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"roles"},{default:t(()=>[l(Y,{modelValue:n.roles,"onUpdate:modelValue":e[12]||(e[12]=a=>n.roles=a),multiple:"",clearable:"",style:{width:"100%"},placeholder:"请选择角色"},{default:t(()=>[(c(!0),g(T,null,L(F.value,a=>(c(),U(W,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"]),l(D,{modelValue:P.value,"onUpdate:modelValue":e[16]||(e[16]=a=>P.value=a),title:"修改密码",width:"40%"},{footer:t(()=>[w("span",Te,[l(o,{onClick:K},{default:t(()=>[p("关闭")]),_:1}),l(o,{type:"primary",onClick:ie},{default:t(()=>[p("提交")]),_:1})])]),default:t(()=>[w("div",null,[l(S,{ref_key:"passFormRef",ref:R,model:f,"status-icon":"",rules:ae,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[l(u,{label:"密码",prop:"password"},{default:t(()=>[l(m,{modelValue:f.password,"onUpdate:modelValue":e[14]||(e[14]=a=>f.password=a),placeholder:"请输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码",prop:"checkPass"},{default:t(()=>[l(m,{modelValue:f.checkPass,"onUpdate:modelValue":e[15]||(e[15]=a=>f.checkPass=a),placeholder:"请再次输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])}}});export{Ye as default};
