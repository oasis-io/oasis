/* empty css             *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                     */import"./el-form-item-4ed993c7.js";/* empty css                    *//* empty css                  *//* empty css                */import{$ as w,d as pe,r as p,a as x,q as me,o as T,t as ce,b as e,w as t,j as c,h as m,g as C,c as fe,F as _e,s as ge,T as we,R as ve,a0 as ye,M as _,m as be,Y as he,z as Ve,O as ke,P as Pe,Q as xe,Z as Ce,a1 as Ee,k as Fe,l as Ue,a2 as Ie,a3 as qe,E as Re,a4 as ze,_ as Se}from"./index-6dee63ee.js";const Be=r=>w({url:"/instance/list",method:"post",data:r}),De=r=>w({url:"/instance",method:"post",data:r}),Me=r=>w({url:"/instance/add",method:"post",data:r}),Te=r=>w({url:"/instance",method:"patch",data:r}),Le=r=>w({url:"/instance/password",method:"patch",data:r}),Qe=r=>w({url:"/instance",method:"delete",data:r}),$e=r=>w({url:"/instance/ping",method:"post",data:r});const Ne={class:"table-box"},Oe={class:"button-left"},je={class:"el-dropdown-link"},Ke={class:"pagination"},Ae={class:"dialog-footer"},We={class:"dialog-footer"},Ye={class:"dialog-footer"},Ze=pe({__name:"index",setup(r){const z=p(0),y=p(1),b=p(10),S=p([]),L=p(!1),Q=p(!1),$=p(!1),h=p(!1),V=p(!1),k=p(!1),P=p(),E=p(),F=p(),N=[{value:"MySQL",label:"MySQL"},{value:"PostgreSQL",label:"PostgreSQL"}],g=async()=>{const o=await Be({pageSize:b.value,currentPage:y.value});o.data.code===1e3&&(S.value=o.data.data.data,z.value=o.data.data.total,b.value=o.data.data.pageSize,y.value=o.data.data.currentPage)};(async()=>{await g()})();const O=o=>{b.value=o,g()},j=o=>{y.value=o,g()},K=async o=>{ye.confirm("此操作将永久删除该实例, 是否继续?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{(await Qe({name:o.name})).data.code===1e3?(_({type:"success",message:"实例删除成功"}),await g()):_({type:"error",message:"实例删除失败"})}).catch(()=>{_({type:"info",message:"取消删除实例"})})},A=()=>{h.value=!0},W=async o=>{f.name=o.name,k.value=!0},Y=async o=>{V.value=!0;const a=await De({name:o.name});a.data.code===1e3&&(n.id=a.data.data.data[0].id,n.name=a.data.data.data[0].name,n.db_type=a.data.data.data[0].db_type,n.host=a.data.data.data[0].host,n.port=a.data.data.data[0].port,n.user=a.data.data.data[0].user)},Z=async o=>{(await $e({name:o.name})).data.code===1e3?_({type:"success",message:"连接数据库成功"}):_({type:"error",message:"连接数据库失败"})},G=(o,a,s)=>{if(a==="")s(new Error("请输入密码"));else{if(d.checkPass!==""){if(!P.value)return;P.value.validateField("checkPass",()=>null)}s()}},H=(o,a,s)=>{a===""?s(new Error("请再次输入密码")):a!=d.password?s(new Error("输入的密码不相同!")):s()},J=x({password:[{required:!0,trigger:"blur"},{required:!0,min:6,max:30,trigger:"blur"}],checkPass:[{required:!0,trigger:"blur"},{required:!0,min:6,max:30,trigger:"blur"},{validator:(o,a,s)=>{a===""?s(new Error("请再次输入密码")):a!==f.password?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}]}),B=x({name:[{required:!0,trigger:"blur"}],db_type:[{required:!0,trigger:"blur"}],host:[{required:!0,trigger:"blur"}],port:[{required:!0,trigger:"blur"}],user:[{required:!0,trigger:"blur"}],password:[{validator:G},{required:!0,min:6,trigger:"blur"}],checkPass:[{validator:H},{required:!0,min:6,trigger:"blur"}]}),n=x({id:0,name:"",db_type:"",host:"",port:"",user:"",password:""}),d=x({name:"",db_type:"",host:"",port:"",user:"",password:"",checkPass:""}),f=x({name:"",password:"",checkPass:""}),D=async()=>{P.value.resetFields(),h.value=!1},X=async()=>{P.value.validate(async o=>{o&&((await Me(d)).data.code===1e3&&(_({type:"success",message:"实例创建成功"}),await g(),D()),h.value=!1)})},M=async()=>{E.value.resetFields(),V.value=!1},ee=async()=>{E.value.validate(async o=>{o&&((await Te(n)).data.code===1e3&&(_({type:"success",message:"实例修改成功"}),await g(),M()),V.value=!1)})},ae=async()=>{F.value.resetFields(),k.value=!1},le=async()=>{F.value.validate(async o=>{o&&((await Le(f)).data.code===1e3&&(_({type:"success",message:"实例密码修改成功"}),await g()),k.value=!1)})};return(o,a)=>{const s=be,v=he,te=me("arrow-down"),oe=Ve,U=ke,se=Pe,ne=xe,de=Ce,re=Ee,i=Fe,u=Ue,ue=Ie,ie=qe,I=Re,q=ze;return T(),ce(ve,null,[e(we,{mode:"out-in",name:"el-fade-in-linear"},{default:t(()=>[c("div",Ne,[c("div",Oe,[e(s,{type:"primary",icon:"plus",onClick:A},{default:t(()=>[m("新增实例")]),_:1})]),e(de,{data:S.value,style:{width:"100%"}},{default:t(()=>[e(v,{align:"left",prop:"name",label:"实例名","min-width":"120"}),e(v,{align:"left",prop:"db_type",label:"数据库类型","min-width":"120"}),e(v,{align:"left",prop:"host",label:"数据库地址","min-width":"120"}),e(v,{align:"left",prop:"port",label:"数据库端口","min-width":"120"}),e(v,{align:"left",prop:"user",label:"连接用户","min-width":"120"}),e(v,{align:"left",label:"操作","min-width":"180",fixed:"right"},{default:t(l=>[c("div",null,[e(s,{icon:"Connection",type:"primary",link:"",onClick:C(R=>Z(l.row),["prevent"])},{default:t(()=>[m(" 连接测试 ")]),_:2},1032,["onClick"]),e(ne,null,{dropdown:t(()=>[e(se,null,{default:t(()=>[e(U,{divided:""},{default:t(()=>[e(s,{icon:"edit",type:"primary",link:"",onClick:C(R=>Y(l.row),["prevent"])},{default:t(()=>[m(" 编辑 ")]),_:2},1032,["onClick"])]),_:2},1024),e(U,{divided:""},{default:t(()=>[e(s,{icon:"delete",type:"primary",link:"",onClick:C(R=>K(l.row),["prevent"])},{default:t(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024),e(U,{divided:""},{default:t(()=>[e(s,{icon:"Lock",type:"primary",link:"",onClick:C(R=>W(l.row),["prevent"])},{default:t(()=>[m(" 修改密码 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:t(()=>[c("span",je,[m(" 更多 "),e(oe,{class:"el-icon--right"},{default:t(()=>[e(te)]),_:1})])]),_:2},1024)])]),_:1})]),_:1},8,["data"]),c("div",Ke,[e(re,{"current-page":y.value,"onUpdate:currentPage":a[0]||(a[0]=l=>y.value=l),"page-size":b.value,"onUpdate:pageSize":a[1]||(a[1]=l=>b.value=l),"page-sizes":[10,20,50],small:L.value,disabled:$.value,background:Q.value,layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:O,onCurrentChange:j},null,8,["current-page","page-size","small","disabled","background","total"])]),e(q,{modelValue:h.value,"onUpdate:modelValue":a[9]||(a[9]=l=>h.value=l),title:"创建实例",width:"40%"},{footer:t(()=>[c("span",Ae,[e(s,{onClick:D},{default:t(()=>[m("关闭")]),_:1}),e(s,{type:"primary",onClick:X},{default:t(()=>[m("提交")]),_:1})])]),default:t(()=>[c("div",null,[e(I,{ref_key:"insFormRef",ref:P,model:d,"status-icon":"",rules:B,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[e(u,{label:"实例名",prop:"name"},{default:t(()=>[e(i,{modelValue:d.name,"onUpdate:modelValue":a[2]||(a[2]=l=>d.name=l),maxlength:"30","show-word-limit":"",placeholder:"请输入实例名"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库类型",prop:"db_type"},{default:t(()=>[e(ie,{modelValue:d.db_type,"onUpdate:modelValue":a[3]||(a[3]=l=>d.db_type=l),placeholder:"数据库类型",style:{width:"100%"}},{default:t(()=>[(T(),fe(_e,null,ge(N,l=>e(ue,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"数据库地址",prop:"host"},{default:t(()=>[e(i,{modelValue:d.host,"onUpdate:modelValue":a[4]||(a[4]=l=>d.host=l),placeholder:"请输入数据库地址"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库端口",prop:"port"},{default:t(()=>[e(i,{modelValue:d.port,"onUpdate:modelValue":a[5]||(a[5]=l=>d.port=l),placeholder:"请输入数据库端口"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库用户",prop:"user"},{default:t(()=>[e(i,{modelValue:d.user,"onUpdate:modelValue":a[6]||(a[6]=l=>d.user=l),placeholder:"请输入连接用户"},null,8,["modelValue"])]),_:1}),e(u,{label:"密码",prop:"password"},{default:t(()=>[e(i,{modelValue:d.password,"onUpdate:modelValue":a[7]||(a[7]=l=>d.password=l),placeholder:"请输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(u,{label:"确认密码",prop:"checkPass"},{default:t(()=>[e(i,{modelValue:d.checkPass,"onUpdate:modelValue":a[8]||(a[8]=l=>d.checkPass=l),placeholder:"请再次输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"]),e(q,{modelValue:V.value,"onUpdate:modelValue":a[15]||(a[15]=l=>V.value=l),title:"修改实例",width:"40%"},{footer:t(()=>[c("span",We,[e(s,{onClick:M},{default:t(()=>[m("关闭")]),_:1}),e(s,{type:"primary",onClick:ee},{default:t(()=>[m("提交")]),_:1})])]),default:t(()=>[c("div",null,[e(I,{ref_key:"editFormRef",ref:E,model:n,"status-icon":"",rules:B,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[e(u,{label:"实例名",prop:"name"},{default:t(()=>[e(i,{modelValue:n.name,"onUpdate:modelValue":a[10]||(a[10]=l=>n.name=l),disabled:"",maxlength:"50","show-word-limit":"",placeholder:"请输入实例名"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库类型",prop:"db_type"},{default:t(()=>[e(i,{modelValue:n.db_type,"onUpdate:modelValue":a[11]||(a[11]=l=>n.db_type=l),disabled:"",placeholder:"请输入数据库类型"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库地址",prop:"host"},{default:t(()=>[e(i,{modelValue:n.host,"onUpdate:modelValue":a[12]||(a[12]=l=>n.host=l),placeholder:"请输入数据库地址"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库端口",prop:"port"},{default:t(()=>[e(i,{modelValue:n.port,"onUpdate:modelValue":a[13]||(a[13]=l=>n.port=l),placeholder:"请输入数据库端口"},null,8,["modelValue"])]),_:1}),e(u,{label:"数据库用户",prop:"user"},{default:t(()=>[e(i,{modelValue:n.user,"onUpdate:modelValue":a[14]||(a[14]=l=>n.user=l),placeholder:"请输入连接用户"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"]),e(q,{modelValue:k.value,"onUpdate:modelValue":a[18]||(a[18]=l=>k.value=l),title:"修改密码",width:"40%"},{footer:t(()=>[c("span",Ye,[e(s,{onClick:ae},{default:t(()=>[m("关闭")]),_:1}),e(s,{type:"primary",onClick:le},{default:t(()=>[m("提交")]),_:1})])]),default:t(()=>[c("div",null,[e(I,{ref_key:"passFormRef",ref:F,model:f,"status-icon":"",rules:J,"label-width":"120px",style:{"max-width":"380px"},class:"demo-ruleForm"},{default:t(()=>[e(u,{label:"密码",prop:"password"},{default:t(()=>[e(i,{modelValue:f.password,"onUpdate:modelValue":a[16]||(a[16]=l=>f.password=l),placeholder:"请输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(u,{label:"确认密码",prop:"checkPass"},{default:t(()=>[e(i,{modelValue:f.checkPass,"onUpdate:modelValue":a[17]||(a[17]=l=>f.checkPass=l),placeholder:"请再次输入密码",autocomplete:"off",type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])]),_:1})],1024)}}});const ua=Se(Ze,[["__scopeId","data-v-d0536f0f"]]);export{ua as default};
